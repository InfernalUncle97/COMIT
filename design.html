<!doctype html>
<html lang="en" data-theme="light">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Design Options & Selection — Saibai Floating Solar</title>
<meta name="color-scheme" content="light dark">
<style>
  /* ===== Design tokens (same family as your other pages) ===== */
  :root{
    --bg:#f3f8fc; --ink:#0f172a; --muted:#475569; --line:#e6eef5; --panel:#ffffff;
    --sea:#0ea5e9; --deep:#2563eb; --reef:#14b8a6; --sun:#f59e0b; --rose:#fb7185;
    --shadow:0 6px 26px rgba(15,23,42,.08); --band:#f8fbfe;
  }
  :root[data-theme="dark"]{
    --bg:#0b1220; --ink:#e7eefc; --muted:#a9b4c9; --line:#24314f; --panel:#0f1730;
    --sea:#22d3ee; --deep:#2563eb; --reef:#34d399; --sun:#fbbf24; --rose:#fb7185;
    --shadow:0 6px 26px rgba(0,0,0,.35); --band:#0f1835;
  }
  *{box-sizing:border-box}
  html,body{margin:0;background:var(--bg);color:var(--ink);font-family:Inter,system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif}
  a{color:var(--sea);text-decoration:none}
  html{scroll-behavior:smooth}

  /* ===== WOW hero (animated wave + floating tiles) ===== */
  .hero{
    position:relative; overflow:hidden; color:#fff;
    background:linear-gradient(90deg,var(--sea),var(--deep));
    border-bottom:1px solid rgba(255,255,255,.25); box-shadow:var(--shadow);
  }
  .hero-inner{max-width:1200px;margin:0 auto;padding:84px 18px 96px}
  .hero h1{margin:0;font-size:clamp(2.4rem,6vw,4rem);letter-spacing:.4px}
  .hero p{opacity:.95;margin-top:8px}
  .float{
    position:absolute; inset:auto; width:110px; aspect-ratio:1; border-radius:18px;
    background:linear-gradient(135deg,#6ee7b7,#22d3ee); filter:blur(0);
    border:1px solid rgba(255,255,255,.6); opacity:.18; box-shadow:0 8px 40px rgba(0,0,0,.18);
    animation:drift 24s ease-in-out infinite alternate;
  }
  .f1{left:6%; top:18%;}
  .f2{right:8%; top:28%; animation-delay:-6s; width:90px}
  .f3{left:16%; bottom:14%; animation-delay:-12s; width:76px}
  @keyframes drift{0%{transform:translateY(0) rotate(0)}100%{transform:translateY(28px) rotate(10deg)}}
  .wave{position:absolute; left:0; right:0; bottom:-1px}

  /* ===== Sticky subnav tabs ===== */
  .subnav{
    position:sticky; top:0; z-index:50;
    background:linear-gradient(90deg,var(--sea),var(--deep));
    border-bottom:1px solid rgba(255,255,255,.25); box-shadow:var(--shadow);
  }
  .tabs{max-width:1200px;margin:0 auto; padding:12px 18px; display:flex; gap:10px; flex-wrap:wrap; align-items:center}
  .brand{display:flex;align-items:center;gap:10px;color:#fff;font-weight:800}
  .logo{width:22px;height:22px;border-radius:7px;background:linear-gradient(135deg,#6ee7b7,#22d3ee);border:1px solid rgba(255,255,255,.6)}
  .tab{display:inline-block;background:rgba(255,255,255,.14);color:#fff;font-weight:800;padding:.55rem .9rem;border-radius:999px;border:1px solid rgba(255,255,255,.45)}
  .tab:hover{background:rgba(255,255,255,.2)}
  .tab.active{background:#fff;color:#0c2440;margin-top:0}

  /* ===== Base layout ===== */
  .wrap{max-width:1200px;margin:0 auto;padding:18px}
  .section{margin-top:18px}
  .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:22px;box-shadow:var(--shadow)}
  .section h2{margin:0 0 .6rem 0;font-size:1.9rem;border-bottom:3px solid var(--sea);padding-bottom:6px}
  .muted{color:var(--muted)}

  /* ===== Options (tilt cards + shine) ===== */
  .options{display:grid;gap:18px}
  .option{
    display:grid;gap:20px;grid-template-columns:1.15fr .85fr;align-items:start;
    perspective:1000px;
  }
  .pane{
    background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:18px;
    transform-style:preserve-3d; transition:transform .25s ease, box-shadow .25s ease;
    position:relative; overflow:hidden;
  }
  .pane:hover{box-shadow:0 22px 60px rgba(15,23,42,.20)}
  .shine{pointer-events:none; position:absolute; inset:0;
         background:radial-gradient(600px 120px at var(--mx,50%) var(--my,0%), rgba(255,255,255,.35), transparent 60%);
         opacity:.0; transition:opacity .2s ease}
  .pane:hover .shine{opacity:.65}
  .pane h3{margin:.2rem 0 .6rem 0}
  figure{margin:0}
  .img{width:100%;height:auto;border-radius:12px;border:1px solid var(--line);box-shadow:var(--shadow)}
  figcaption{color:var(--muted);font-size:.92rem;margin-top:6px}
  @media (max-width:980px){ .option{grid-template-columns:1fr} }

  /* ===== Criteria bands ===== */
  .bands .band{padding:26px;border-radius:14px;border:1px solid var(--line);background:var(--panel)}
  .bands .band.alt{background:var(--band)}
  .bands h3{margin:.2rem 0 10px 0;font-size:1.35rem}
  .bands p{margin:.4rem 0 0 0;line-height:1.65}

  /* ===== Matrix table ===== */
  .table-wrap{margin-top:12px;overflow:auto;border-radius:12px;border:1px solid var(--line);box-shadow:var(--shadow)}
  table{width:100%;border-collapse:separate;border-spacing:0;background:var(--panel)}
  thead th{
    background:linear-gradient(180deg,#e2f0f6,#d6e9f3);
    color:#0c2440;font-weight:800;padding:14px;border-bottom:1px solid var(--line);text-align:left
  }
  th:first-child{border-top-left-radius:12px}
  th:last-child{border-top-right-radius:12px}
  tbody td{padding:14px;border-top:1px solid var(--line);vertical-align:middle}
  tbody tr:nth-child(odd) td{background:linear-gradient(180deg,#ffffff,#f8fbfe)}
  :root[data-theme="dark"] tbody tr:nth-child(odd) td{background:linear-gradient(180deg,#0f1730,#0f1838)}
  tfoot td{padding:16px 14px;font-weight:800;border-top:2px solid var(--line);background:#f4f9fd}
  :root[data-theme="dark"] tfoot td{background:#0f1835}
  .best{background:linear-gradient(180deg,#ecfeff,#d1fae5)!important}
  :root[data-theme="dark"] .best{background:linear-gradient(180deg,#0b2d2f,#0d3a2f)!important}
  .crown{font-size:1rem;margin-left:6px}

  /* ===== Radar + weights ===== */
  .matrix-grid{display:grid;gap:18px;grid-template-columns:1.25fr .75fr}
  @media (max-width:980px){ .matrix-grid{grid-template-columns:1fr} }
  .radarCard{display:grid;gap:10px}
  .radarCard canvas{width:100%;height:360px;display:block}
  details.weights{margin-top:12px;border:1px dashed var(--line);border-radius:12px;padding:12px;background:var(--band)}
  .weights summary{font-weight:800;cursor:pointer}
  .grid-weights{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
  @media (max-width:800px){ .grid-weights{grid-template-columns:1fr} }
  .row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
  input[type="range"]{width:100%}
  .num{width:90px;padding:8px;border:1px solid var(--line);border-radius:10px;background:transparent;color:var(--ink);font-weight:700;text-align:right}

  /* ===== Scroll reveal ===== */
  .reveal{opacity:0;transform:translateY(14px);transition:opacity .5s ease, transform .5s ease}
  .reveal.show{opacity:1;transform:none}

  /* ===== Confetti (winner celebration) ===== */
  #confetti{position:fixed;inset:0;pointer-events:none;z-index:60}
</style>
</head>
<body>

<!-- WOW hero -->
<header class="hero" aria-label="Intro">
  <div class="hero-inner">
    <h1>Design Options &amp; Selection</h1>
    <p>From possibilities to a community-led choice — explore the options, criteria and decision that favour floating solar for Saibai.</p>
  </div>

  <!-- decorative floaters -->
  <div class="float f1"></div><div class="float f2"></div><div class="float f3"></div>

  <!-- animated wave -->
  <svg class="wave" viewBox="0 0 1200 120" preserveAspectRatio="none" aria-hidden="true">
    <defs>
      <linearGradient id="g" x1="0" x2="1" y1="0" y2="0">
        <stop offset="0" stop-color="rgba(255,255,255,.35)"/>
        <stop offset="1" stop-color="rgba(255,255,255,.08)"/>
      </linearGradient>
    </defs>
    <path fill="url(#g)">
      <animate attributeName="d" dur="10s" repeatCount="indefinite"
        values="
        M0,40 C300,90 900,-10 1200,50 L1200,120 L0,120 Z;
        M0,50 C300,10 900,110 1200,60 L1200,120 L0,120 Z;
        M0,40 C300,90 900,-10 1200,50 L1200,120 L0,120 Z"/>
    </path>
  </svg>
</header>

<!-- Sticky tabs -->
<nav class="subnav" aria-label="Sections">
  <div class="tabs">
    <span class="brand"><span class="logo" aria-hidden="true"></span> Community Energy — Saibai</span>
    <a class="tab" data-nav href="#options">Options</a>
    <a class="tab" data-nav href="#criteria">Design Criteria</a>
    <a class="tab" data-nav href="#matrix">Decision Matrix</a>
    <a class="tab" data-nav href="#justification">Justification</a>
    <a class="tab" data-nav href="#selected">Selected Design</a>
  </div>
</nav>

<canvas id="confetti"></canvas>

<main class="wrap">

  <!-- OPTIONS ======================================================= -->
  <section id="options" class="section card reveal">
    <h2>Options</h2>
    <div class="options">

      <!-- Option 1 -->
      <article class="option">
        <div class="pane tilt" data-tilt>
          <div class="shine"></div>
          <h3>Option 1: Wind Turbines</h3>
          <p>This solution would involve the construction of a number of wind turbines on Saibai Island. The consistent wind currents passing through Saibai Island would provide a constant stream of clean energy to residents. There are concerns regarding the proximity of these wind turbines to the residential areas of Saibai and the suitability of the land for their installation.</p>
        </div>
        <figure class="pane">
          <img class="img" src="design1.png" alt="Onshore wind turbines near coast">
          <figcaption>Onshore wind turbines — Webb Institute (n.d.)</figcaption>
        </figure>
      </article>

      <!-- Option 2 -->
      <article class="option">
        <div class="pane tilt" data-tilt>
          <div class="shine"></div>
          <h3>Option 2: Land-based Solar Panels</h3>
          <p>This solution involves the installation of a land-based solar panel array on land nearby to the Saibai community. This would provide a constant stream of energy during the day and charge batteries to power the community during nights and overcast days.</p>
        </div>
        <figure class="pane">
          <img class="img" src="design2.png" alt="Rows of land based solar panels">
          <figcaption>View of a land-based solar farm — ColdwellSolar (n.d.)</figcaption>
        </figure>
      </article>

      <!-- Option 3 -->
      <article class="option">
        <div class="pane tilt" data-tilt>
          <div class="shine"></div>
          <h3>Option 3: Floating Solar Panels</h3>
          <p>Similar to land-based solar panels, this solution involves constructing platforms which have an array of solar panels attached to their top. This would provide a constant stream of energy during the day and charge batteries to power the community during nights and overcast days. Unlike the land-based solar model, this would save much more land space to be used by the Saibai residents.</p>
        </div>
        <figure class="pane">
          <img class="img" src="design3.png" alt="Circular floating solar platform on a water body">
          <figcaption>A floating solar panel array — SolarisFloat (2022)</figcaption>
        </figure>
      </article>

    </div>
  </section>

  <!-- CRITERIA ====================================================== -->
  <section id="criteria" class="section card reveal">
    <h2>Design Criteria</h2>
    <div class="bands" style="display:grid;gap:14px">
      <div class="band">
        <h3>Cultural Sustainability</h3>
        <p>The impact of the design solution on Saibai Island residents’ connection with culture. A positive impact is ideal, otherwise the impact must be minimised to ensure cultural activities are not disrupted. Improving the consistency and cost of energy on Saibai Island would be wasted if it were to degrade residents’ connection to their culture. Because of this, ensuring that the chosen solution has a minimal or positive impact on the culture of Saibai residents is essential. This can be achieved by consulting Saibai Island residents to provide feedback before and during the implementation phase.</p>
      </div>
      <div class="band alt">
        <h3>Environmental Sustainability</h3>
        <p>The environmental impact of the solution by comparing carbon emissions. The aim is to reduce carbon emissions as much as possible. Saibai Island residents are victims to climate change, as sea levels rise and severe weather conditions such as floods become more common, Saibai Island residents are increasingly threatened. It must be ensured that the chosen design does not have adverse environmental effects such as worsening climate change, nor does it cause changes to the local maritime ecosystems which Saibai residents rely on from day to day.</p>
      </div>
      <div class="band">
        <h3>Robustness</h3>
        <p>How readily the design solution is able to withstand the weather conditions on and around Saibai Island. The design should last at least 15 years without significant interruption to power generation and distribution. Saibai Island frequently experiences rough weather conditions. Our solution must be able to withstand these conditions in order to provide a consistent and reliable energy source for Saibai Island residents.</p>
      </div>
      <div class="band alt">
        <h3>Initial Cost</h3>
        <p>The initial cost of implementing the design solution. This includes purchasing materials, transport and labour costs for the construction and starting up the design solution. If the initial cost is too large to be funded, the project won’t be able to get off the ground and may result in a cost greater than the current diesel energy system.</p>
      </div>
      <div class="band">
        <h3>Maintenance Cost</h3>
        <p>The maintenance costs over the lifetime of the design solution. This may include labour costs for routine maintenance and cost of replacement parts if repair is necessary. Reducing maintenance costs should make up the largest long-term savings for the life of the design solution. The current system uses diesel as its fuel source which is highly costly to transport from the mainland and can also be unreliable due to supply chain issues. Any new system should be well below the cost of importing diesel for fuel over its lifetime.</p>
      </div>
      <div class="band alt">
        <h3>Complexity</h3>
        <p>The complexity of the design solution. A less complex design is better. By reducing the complexity of the design, we can train Saibai residents in maintenance of the system. This will reduce the need to fly in specialist maintenance staff from outside of Saibai and stimulating the Saibai Island economy by creating more jobs for residents.</p>
      </div>
    </div>
  </section>

  <!-- MATRIX ======================================================== -->
  <section id="matrix" class="section card reveal">
    <h2>Decision Matrix</h2>

    <div class="matrix-grid">
      <div>
        <div class="table-wrap" role="region" aria-label="Design decision matrix">
          <table id="dmatrix">
            <thead>
              <tr>
                <th>Criteria</th>
                <th>Ground-Based Solar</th>
                <th>Hybrid Microgrid</th>
                <th>Floating Solar</th>
              </tr>
            </thead>
            <tbody>
              <tr data-crit="Flood and Tide Resilience" data-weight="1">
                <td>Flood and Tide Resilience</td><td data-val="1">1</td><td data-val="3">3</td><td data-val="5">5</td>
              </tr>
              <tr data-crit="Land Use Efficiency" data-weight="1">
                <td>Land Use Efficiency</td><td data-val="1">1</td><td data-val="2">2</td><td data-val="5">5</td>
              </tr>
              <tr data-crit="Environmental Sustainability" data-weight="1">
                <td>Environmental Sustainability</td><td data-val="3">3</td><td data-val="4">4</td><td data-val="5">5</td>
              </tr>
              <tr data-crit="Local Maintenance Capability" data-weight="1">
                <td>Local Maintenance Capability</td><td data-val="2">2</td><td data-val="3">3</td><td data-val="4">4</td>
              </tr>
              <tr data-crit="Affordability (Long-Term)" data-weight="1">
                <td>Affordability (Long-Term)</td><td data-val="2">2</td><td data-val="3">3</td><td data-val="4">4</td>
              </tr>
              <tr data-crit="Scalability and Modularity" data-weight="1">
                <td>Scalability and Modularity</td><td data-val="2">2</td><td data-val="4">4</td><td data-val="5">5</td>
              </tr>
              <tr data-crit="Cultural and Community Alignment" data-weight="1">
                <td>Cultural and Community Alignment</td><td data-val="3">3</td><td data-val="4">4</td><td data-val="5">5</td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td>Weighted Total</td>
                <td id="tot-gs">—</td>
                <td id="tot-hm">—</td>
                <td id="tot-fs">—</td>
              </tr>
            </tfoot>
          </table>
        </div>

        <details class="weights">
          <summary>Adjust criterion weights (optional)</summary>
          <p class="muted">Default weight = 1. Increase a weight to give that criterion more influence on the totals and the radar chart.</p>
          <div class="grid-weights" id="weightsPanel"></div>
        </details>
      </div>

      <div class="card radarCard">
        <canvas id="radar" aria-label="Radar comparison of options"></canvas>
      </div>
    </div>
  </section>

  <!-- JUSTIFICATION ================================================= -->
  <section id="justification" class="section card reveal">
    <h2>Decision Justification</h2>
    <ul>
      <li>The Floating Solar System achieved the highest overall rating across nearly all criteria.</li>
      <li>The design directly addresses Saibai’s flooding and land scarcity issues by locating infrastructure offshore.</li>
      <li>It promotes local training and employment, aligning with TSIRC’s goals for community-led energy projects.</li>
      <li>Maintenance can be handled primarily by trained local rangers and youth, reducing reliance on external contractors.</li>
      <li>The modular nature of the system allows phased construction, making it financially and logistically feasible.</li>
      <li>It ensures long-term environmental and economic sustainability by significantly reducing diesel dependence and fuel transport emissions.</li>
    </ul>
  </section>

  <!-- SELECTED ====================================================== -->
  <section id="selected" class="section card reveal">
    <h2>Selected Design</h2>
    <p>Based on the decision matrix and criteria evaluation, the <strong>Floating Solar System</strong> was selected as the final design to be developed. This system uses 10×10&nbsp;m HDPE floating platforms with solar panels and a dual battery/converter unit mounted on stilts near shore. It provides a clean, flood-resilient, and community-managed solution that preserves land for housing and cultural use while ensuring reliable power generation.</p>
  </section>

<!-- ===================== DETAIL: INTERACTIVE DIAGRAM + ENERGY FLOW ===================== -->
<section class="section card" id="detail-interact">
  <h2>Detailed Design — Interactive</h2>

  <!-- ===== 1) Annotated Exploded Diagram ===== -->
  <div class="diagram">
    <header class="di-head">
      <strong>System Diagram</strong>
      <span class="muted">Scroll/touch to zoom · drag to pan · click labels</span>
      <div class="di-zoom">
        <button class="btn-lite" data-zoom="-">–</button>
        <button class="btn-lite" data-zoom="+">+</button>
        <button class="btn-lite" data-zoom="1">100%</button>
      </div>
    </header>

    <div class="di-stage" aria-label="Exploded system diagram" role="region">
      <img class="di-img" src="design4.png" alt="Floating solar system diagram">

      <!-- Hotspots: position with left/top in percentages so it scales with the image -->
      <button class="hotspot" style="left:43%;top:52%" data-title="PV Modules"
        data-body="Panels mounted on the floating frame. Seawater cooling improves efficiency compared to land arrays.">1</button>

      <button class="hotspot" style="left:34%;top:70%" data-title="Floating Platform"
        data-body="HDPE floats with aluminium superstructure; buoyant, UV-resistant, cyclone-ready.">2</button>

      <button class="hotspot" style="left:54%;top:78%" data-title="Junction Box"
        data-body="Collects DC from strings; surge protection and isolation before sub-sea export.">3</button>

      <button class="hotspot" style="left:66%;top:65%" data-title="Submarine Cable"
        data-body="Armoured, UV-resistant, wet-mate rated; carries DC ashore to the converter.">4</button>

      <button class="hotspot" style="left:73%;top:33%" data-title="Power Converter (onshore)"
        data-body="DC-AC conversion, protection &amp; telemetry; feeds the microgrid and charges the batteries.">5</button>

      <button class="hotspot" style="left:40%;top:84%" data-title="Anchors &amp; Moorings"
        data-body="Catenary or taut moorings sized for tides, surge and wave climate; keeps array aligned to the sun.">6</button>
    </div>

    <aside class="di-panel" aria-live="polite">
      <h3 id="di-title">Tap a label</h3>
      <p class="muted" id="di-body">Hover/click a numbered tag to see details.</p>
      <details class="note" open>
        <summary><strong>Tip:</strong> How to read</summary>
        <p>Start at the panels (1), follow DC through the junction box (3) into the submarine cable (4) and onto the onshore converter (5).</p>
      </details>
    </aside>
  </div>

  <!-- ===== 2) Energy Flow — Guided Stepper ===== -->
  <div class="flow">
    <header class="di-head">
      <strong>Energy Flow Summary</strong>
      <span class="muted">Follow the numbered steps</span>
    </header>

    <div class="flow-grid">
      <figure class="flow-fig">
        <img class="flow-img" src="des" alt="Energy flow overview">
        <!-- Overlays that light up per step (coords in %) -->
        <span class="pin" style="left:28%;top:40%" data-step="1">1</span>
        <span class="pin" style="left:40%;top:48%" data-step="2">2</span>
        <span class="pin" style="left:52%;top:64%" data-step="3">3</span>
        <span class="pin" style="left:68%;top:58%" data-step="4">4</span>
        <span class="pin" style="left:80%;top:32%" data-step="5">5</span>
        <span class="pin" style="left:86%;top:44%" data-step="6">6</span>
        <span class="pin" style="left:90%;top:54%" data-step="7">7</span>
      </figure>

      <div class="flow-steps">
        <ol id="flowList">
          <li data-step="1"><strong>Sunlight</strong> makes contact with the PV modules.</li>
          <li data-step="2">The PV modules convert sunlight into <strong>DC</strong> electricity.</li>
          <li data-step="3">The junction box gathers <strong>DC</strong> and sends it through the submarine cable.</li>
          <li data-step="4">The onshore converter receives the <strong>DC</strong> electricity.</li>
          <li data-step="5">The converter transforms <strong>DC → AC</strong> for the grid.</li>
          <li data-step="6">The dual-battery system stores excess energy for later use.</li>
          <li data-step="7"><strong>AC</strong> power is distributed to the island’s network.</li>
        </ol>
        <div class="stepper">
          <button class="btn-lite" data-prev>Prev</button>
          <div class="dots" id="flowDots" aria-hidden="true"></div>
          <button class="btn-lite" data-next>Next</button>
        </div>
      </div>
    </div>
  </div>
</section>

<style>
/* --- local styles for this block (inherit your tokens) --- */
#detail-interact .di-head{display:flex;gap:16px;align-items:center;justify-content:space-between;margin-bottom:12px}
#detail-interact .btn-lite{appearance:none;border:1px solid var(--line);background:var(--panel);padding:.45rem .65rem;border-radius:10px;cursor:pointer;font-weight:700}
#detail-interact .btn-lite:hover{background:#f8fbff}
#detail-interact .di-zoom{display:flex;gap:8px}

.diagram{display:grid;gap:16px;grid-template-columns:1.25fr .75fr}
@media (max-width:1000px){.diagram{grid-template-columns:1fr}}
.di-stage{position:relative;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:linear-gradient(180deg,#fff,#f6fbff)}
:root[data-theme="dark"] .di-stage{background:linear-gradient(180deg,#0f1730,#0f1838)}
.di-img{display:block;max-width:100%;height:auto;transform-origin:0 0;user-select:none;touch-action:none;cursor:grab}
.di-stage.dragging .di-img{cursor:grabbing}

.hotspot{position:absolute;transform:translate(-50%,-50%);
  width:28px;height:28px;border-radius:50%;border:none;color:#fff;font-weight:800;cursor:pointer;
  background:linear-gradient(135deg,#22d3ee,#2563eb);box-shadow:0 4px 10px rgba(0,0,0,.2)}
.hotspot:focus-visible{outline:3px solid var(--reef)}

.di-panel{border:1px solid var(--line);border-radius:14px;padding:16px;background:var(--panel);box-shadow:var(--shadow)}
.di-panel h3{margin:.2rem 0}

.flow .flow-grid{display:grid;gap:16px;grid-template-columns:1.15fr .85fr}
@media (max-width:1000px){.flow .flow-grid{grid-template-columns:1fr}}
.flow-fig{position:relative;margin:0;border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--panel)}
.flow-img{display:block;width:100%;height:auto}
.pin{position:absolute;transform:translate(-50%,-50%);
  width:30px;height:30px;border-radius:50%;display:grid;place-items:center;
  background:#0ea5e9;color:#fff;font-weight:900;box-shadow:0 6px 18px rgba(14,165,233,.35);opacity:.55;transition:opacity .2s, transform .2s}
.pin.active{opacity:1;transform:translate(-50%,-50%) scale(1.06);background:#14b8a6}

.flow-steps ol{margin:0;padding-left:20px;display:grid;gap:10px}
.flow-steps li{background:var(--panel);border:1px solid var(--line);border-radius:10px;padding:10px;list-style:decimal}
.flow-steps li.active{border-color:#22d3ee;box-shadow:0 0 0 3px rgba(34,211,238,.15)}
.stepper{display:flex;align-items:center;gap:10px;margin-top:10px}
.dots{display:flex;gap:6px;flex:1;justify-content:center}
.dots i{width:8px;height:8px;border-radius:999px;background:var(--line)}
.dots i.on{background:#34d399;box-shadow:0 0 0 3px rgba(52,211,153,.18);}

.note{margin-top:10px}
</style>

<script>
/* ========= 1) Zoom/Pan + Hotspots ========= */
(function(){
  const stage = document.querySelector('.di-stage');
  const img   = stage.querySelector('.di-img');
  const panelT = document.getElementById('di-title');
  const panelB = document.getElementById('di-body');

  let scale = 1, minS = 1, maxS = 3;
  let ox = 0, oy = 0;       // current offset
  let sx = 0, sy = 0;       // drag start
  let dragging = false;

  function apply(){ img.style.transform = `translate(${ox}px,${oy}px) scale(${scale})`; }
  function clamp(){
    // keep within bounds
    const w = img.naturalWidth * scale, h = img.naturalHeight * scale;
    const vw = stage.clientWidth, vh = stage.clientHeight;
    const maxX = Math.max(0,(w - vw)/2), maxY = Math.max(0,(h - vh)/2);
    ox = Math.max(-maxX, Math.min(maxX, ox));
    oy = Math.max(-maxY, Math.min(maxY, oy));
  }
  // wheel zoom
  stage.addEventListener('wheel', e=>{
    e.preventDefault();
    const dir = Math.sign(e.deltaY)*-1;
    const prev = scale;
    scale = Math.max(minS, Math.min(maxS, scale + dir*0.15));
    // zoom towards cursor
    const rect = stage.getBoundingClientRect();
    const cx = e.clientX - rect.left - stage.clientWidth/2;
    const cy = e.clientY - rect.top  - stage.clientHeight/2;
    ox = (ox - cx) * (scale/prev) + cx;
    oy = (oy - cy) * (scale/prev) + cy;
    clamp(); apply();
  }, {passive:false});

  // buttons
  document.querySelectorAll('.di-zoom .btn-lite').forEach(b=>{
    b.addEventListener('click', ()=>{
      const t = b.getAttribute('data-zoom');
      if(t==='+') scale = Math.min(maxS, scale+0.2);
      else if(t==='-') scale = Math.max(minS, scale-0.2);
      else scale = 1, ox = oy = 0;
      clamp(); apply();
    });
  });

  // drag to pan
  stage.addEventListener('pointerdown', e=>{
    stage.classList.add('dragging');
    dragging = true; sx = e.clientX - ox; sy = e.clientY - oy; stage.setPointerCapture(e.pointerId);
  });
  stage.addEventListener('pointermove', e=>{
    if(!dragging) return;
    ox = e.clientX - sx; oy = e.clientY - sy; clamp(); apply();
  });
  stage.addEventListener('pointerup', e=>{
    dragging = false; stage.classList.remove('dragging'); stage.releasePointerCapture(e.pointerId);
  });

  // hotspots
  stage.querySelectorAll('.hotspot').forEach(h=>{
    h.addEventListener('click', ()=>{
      panelT.textContent = h.dataset.title;
      panelB.textContent = h.dataset.body;
      stage.querySelectorAll('.hotspot').forEach(x=>x.style.outline='none');
      h.style.outline = '3px solid rgba(34,211,238,.45)';
    });
  });
})();

/* ========= 2) Energy Flow stepper ========= */
(function(){
  const list = document.getElementById('flowList');
  const items = Array.from(list.querySelectorAll('li'));
  const pins = Array.from(document.querySelectorAll('.pin'));
  const dots = document.getElementById('flowDots');
  let idx = 0;

  // build dots
  for(let i=0;i<items.length;i++){
    const d=document.createElement('i'); dots.appendChild(d);
  }
  const dotEls = Array.from(dots.children);

  function setActive(i){
    idx = Math.max(0, Math.min(items.length-1, i));
    items.forEach(li=>li.classList.toggle('active', Number(li.dataset.step)-1===idx));
    pins.forEach(p=>p.classList.toggle('active', Number(p.dataset.step)-1===idx));
    dotEls.forEach((d,j)=>d.classList.toggle('on', j<=idx));
    // scroll into view on small screens
    items[idx].scrollIntoView({block:'nearest', behavior:'smooth'});
  }
  setActive(0);

  document.querySelector('[data-next]').addEventListener('click', ()=>setActive(idx+1));
  document.querySelector('[data-prev]').addEventListener('click', ()=>setActive(idx-1));
  pins.forEach(p=>p.addEventListener('click', ()=>setActive(Number(p.dataset.step)-1)));
  items.forEach(li=>li.addEventListener('click', ()=>setActive(Number(li.dataset.step)-1)));
})();
</script>


</main>

<script>
/* Persist theme if you use a toggle on other pages */
const key='saibai-theme'; const saved = localStorage.getItem(key);
if(saved) document.documentElement.setAttribute('data-theme', saved);

/* Helpers */
const $ = s => document.querySelector(s);
const $$ = s => Array.from(document.querySelectorAll(s));

/* ============== WOW 1: tilt cards with pointer-position shine ============== */
$$('.tilt').forEach(card=>{
  const shine = card.querySelector('.shine');
  card.addEventListener('pointermove', e=>{
    const r = card.getBoundingClientRect();
    const x = e.clientX - r.left, y = e.clientY - r.top;
    const rx = ((y/r.height)-0.5)*-8, ry = ((x/r.width)-0.5)*8;
    card.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
    shine && (shine.style.setProperty('--mx', (x/r.width*100)+'%'),
               shine.style.setProperty('--my', (y/r.height*100)+'%'));
  });
  card.addEventListener('pointerleave', ()=> card.style.transform='none');
});

/* ============== Scroll reveal ============== */
const io = new IntersectionObserver((entries)=>{
  entries.forEach(e=>{ if(e.isIntersecting){ e.target.classList.add('show'); io.unobserve(e.target);} });
},{threshold:.12});
$$('.reveal').forEach(el=>io.observe(el));

/* ============== Tabs highlight on scroll ============== */
const tabs = $$('.tab[data-nav]');
const sections = tabs.map(t => document.querySelector(t.getAttribute('href')));
const obs = new IntersectionObserver(entries=>{
  entries.forEach(e=>{
    if(e.isIntersecting){
      const id = '#' + e.target.id;
      tabs.forEach(t=>t.classList.toggle('active', t.getAttribute('href')===id));
      history.replaceState(null,'',id);
    }
  });
},{rootMargin:'-50% 0px -45% 0px', threshold:0});
sections.forEach(s=>obs.observe(s));

/* ============== Matrix totals + Confetti celebration ============== */


$$('#dmatrix tbody tr').forEach((row, idx)=>{
  const name = row.getAttribute('data-crit');
  const w = Number(row.getAttribute('data-weight')||1);
  const id = 'w_' + idx;
  const block = document.createElement('div');
  block.className = 'row';
  block.innerHTML = `
    <label for="${id}"><strong>${name}</strong></label>
    <div style="display:flex;gap:8px;align-items:center">
      <input id="${id}" type="range" min="0" max="5" step="0.5" value="${w}">
      <input data-weightbox="${idx}" class="num" type="number" min="0" max="5" step="0.5" value="${w}">
    </div>`;
  weightsPanel.appendChild(block);

  const range = block.querySelector('input[type="range"]');
  const box = block.querySelector('input[type="number"]');
  function sync(val){
    range.value = val; box.value = val;
    row.setAttribute('data-weight', String(val));
    calcTotals(true);
  }
  range.addEventListener('input', ()=>sync(range.value));
  box.addEventListener('input', ()=>{
    let v = parseFloat(box.value||'0'); if(isNaN(v)) v = 1;
    v = Math.max(0, Math.min(5, v)); sync(v);
  });
});

function calcTotals(animateRadar=false){
  const rows = $$('#dmatrix tbody tr');
  const sums = { gs:0, hm:0, fs:0 };
  const crits=[], wts=[];
  rows.forEach(r=>{
    const w = Number(r.getAttribute('data-weight')||1);
    const tds = r.querySelectorAll('td[data-val]');
    sums.gs += w * Number(tds[0].dataset.val);
    sums.hm += w * Number(tds[1].dataset.val);
    sums.fs += w * Number(tds[2].dataset.val);
    crits.push(r.getAttribute('data-crit'));
    wts.push(w);
  });

  $('#tot-gs').textContent = sums.gs.toFixed(1);
  $('#tot-hm').textContent = sums.hm.toFixed(1);
  $('#tot-fs').textContent = sums.fs.toFixed(1);

  // clear styles
  $$('#dmatrix tbody td, #dmatrix tfoot td').forEach(td=>td.classList.remove('best'));
  $$('.crown').forEach(c=>c.remove());

  // pick winner
  const max = Math.max(sums.gs, sums.hm, sums.fs);
  const colIndex = (sums.fs===max)?3 : (sums.hm===max?2:1);
  const winnerName = colIndex===3 ? 'Floating Solar' : (colIndex===2 ? 'Hybrid Microgrid' : 'Ground-Based Solar');

  $$('#dmatrix tr').forEach(tr=>{
    const tds = tr.children;
    if(tds[colIndex]) tds[colIndex].classList.add('best');
  });
  const headCell = $('#dmatrix thead tr').children[colIndex];
  if(headCell){ const span = document.createElement('span'); span.className='crown'; span.textContent='👑'; headCell.appendChild(span); }

  // party if the winner changes to Floating Solar
  if(winnerName==='Floating Solar' && lastWinner!=='Floating Solar'){
    burstConfetti();
  }
  lastWinner = winnerName;

  // update radar
  const values = {
    labels: crits,
    weights: wts,
    gs: rows.map(r=>Number(r.querySelectorAll('td[data-val]')[0].dataset.val)),
    hm: rows.map(r=>Number(r.querySelectorAll('td[data-val]')[1].dataset.val)),
    fs: rows.map(r=>Number(r.querySelectorAll('td[data-val]')[2].dataset.val)),
  };
  drawRadar(values, animateRadar);
}

/* ============== WOW 2: Radar chart (Canvas, no libs) ============== */
const radar = $('#radar');
const rctx = radar.getContext('2d');
function drawRadar(data, animate){
  const W = radar.clientWidth||640, H = 360;
  radar.width = W * devicePixelRatio; radar.height = H * devicePixelRatio; rctx.scale(devicePixelRatio, devicePixelRatio);
  rctx.clearRect(0,0,W,H);

  const cx = W/2, cy = H/2 + 10, r = Math.min(W, H)/2 - 30;
  const n = data.labels.length;
  const ang = (i)=> -Math.PI/2 + i*(2*Math.PI/n);

  // grid
  rctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--line');
  for(let k=1;k<=4;k++){
    rctx.beginPath();
    for(let i=0;i<n;i++){
      const a = ang(i);
      const rr = (k/4)*r;
      const x = cx + rr*Math.cos(a), y = cy + rr*Math.sin(a);
      i===0 ? rctx.moveTo(x,y) : rctx.lineTo(x,y);
    }
    rctx.closePath(); rctx.stroke();
  }

  // labels
  rctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--ink');
  rctx.font = '12px system-ui';
  for(let i=0;i<n;i++){
    const a = ang(i); const x = cx + (r+10)*Math.cos(a), y = cy + (r+10)*Math.sin(a);
    rctx.textAlign = (Math.cos(a)>0.2)?'left':(Math.cos(a)<-0.2?'right':'center');
    rctx.textBaseline = (Math.sin(a)>0.2)?'top':(Math.sin(a)<-0.2?'bottom':'middle');
    rctx.fillText(data.labels[i], x, y);
  }

  // helper to draw a dataset
  function poly(vals, color){
    rctx.beginPath();
    vals.forEach((v,i)=>{
      const a = ang(i);
      const rr = (v/5) * r;
      const x = cx + rr*Math.cos(a), y = cy + rr*Math.sin(a);
      i===0 ? rctx.moveTo(x,y) : rctx.lineTo(x,y);
    });
    rctx.closePath();
    rctx.fillStyle = color; rctx.globalAlpha=.22; rctx.fill(); rctx.globalAlpha=1;
    rctx.strokeStyle = color; rctx.lineWidth = 2; rctx.stroke();
  }

  // apply weights (scale each axis)
  const wScale = data.weights.map(w=>Math.max(0.4, Math.min(1.2, w/1))); // visual emphasis
  const gsW = data.gs.map((v,i)=>Math.min(5, v*wScale[i]));
  const hmW = data.hm.map((v,i)=>Math.min(5, v*wScale[i]));
  const fsW = data.fs.map((v,i)=>Math.min(5, v*wScale[i]));

  // animate in
  if(animate){
    const start = performance.now();
    (function step(t){
      const p = Math.min(1,(t-start)/550);
      const ease = 1 - Math.pow(1-p,3);
      const lerp = (arr)=>arr.map(v=>v*ease);
      rctx.clearRect(0,0,W,H);
      // redraw grid/labels each frame
      drawRadar({labels:data.labels,weights:data.weights,gs:data.gs,hm:data.hm,fs:data.fs}, false);
      poly(lerp(gsW), '#fb7185'); poly(lerp(hmW), '#22d3ee'); poly(lerp(fsW), '#34d399');
      if(p<1) requestAnimationFrame(step);
    })(start);
  } else {
    poly(gsW, '#fb7185'); poly(hmW, '#22d3ee'); poly(fsW, '#34d399');
  }
}

/* ============== Confetti ============== */
const cCan = $('#confetti'); const cCtx = cCan.getContext('2d');
function sizeConfetti(){ cCan.width = innerWidth*devicePixelRatio; cCan.height = innerHeight*devicePixelRatio; cCtx.scale(devicePixelRatio, devicePixelRatio); }
sizeConfetti(); addEventListener('resize', sizeConfetti);
let confettiParts = [];
function burstConfetti(){
  confettiParts = [];
  const colors = ['#22d3ee','#34d399','#fbbf24','#fb7185'];
  for(let i=0;i<120;i++){
    confettiParts.push({
      x: innerWidth/2, y: 80, r: Math.random()*5+2,
      vx: (Math.random()-0.5)*6, vy: Math.random()*-4-2,
      g: .12+Math.random()*.05, c: colors[i%colors.length], a: 1, s: Math.random()*2*Math.PI
    });
  }
  (function anim(){
    cCtx.clearRect(0,0,innerWidth,innerHeight);
    confettiParts.forEach(p=>{
      p.vy += p.g; p.x += p.vx; p.y += p.vy; p.a -= .008; p.s += .1;
      cCtx.globalAlpha = Math.max(0,p.a);
      cCtx.fillStyle = p.c; cCtx.save();
      cCtx.translate(p.x,p.y); cCtx.rotate(p.s);
      cCtx.fillRect(-p.r,-p.r,p.r*2,p.r*2);
      cCtx.restore();
    });
    cCtx.globalAlpha = 1;
    confettiParts = confettiParts.filter(p=>p.a>0 && p.y<innerHeight+20);
    if(confettiParts.length) requestAnimationFrame(anim);
  })();
}

/* ============== Init ============== */
calcTotals(false);   // compute totals & draw radar once
addEventListener('resize', ()=>drawRadar({labels:[],weights:[],gs:[],hm:[],fs:[]}, false) || calcTotals(false)); // re-measure radar on resize
</script>
</body>
</html>
